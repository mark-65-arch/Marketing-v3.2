---
// üéØ Base Layout Component
// Purpose: Consistent HTML structure, SEO optimization, and performance best practices
// Used by: All pages across the site
import '../styles/global.css';
import CookieBanner from '../components/CookieBanner.astro';

interface Props {
  title?: string;
  description?: string;
  canonicalURL?: string;
  ogImage?: string;
  noindex?: boolean;
  structuredData?: object;
  lang?: string;
  alternateLanguages?: { lang: string; url: string }[];
}

const {
  title = "Marketing AI Houston - AI-Powered Web Design & SEO for Small Businesses",
  description = "Professional web design and SEO services powered by AI technology for Houston small businesses. Get found online with modern, conversion-focused websites.",
  canonicalURL,
  ogImage = `${import.meta.env.SITE}${import.meta.env.BASE_URL}og-image.png`,
  noindex = false,
  structuredData,
  lang = "en",
  alternateLanguages = []
} = Astro.props;

// üîç SEO: Generate canonical URL if not provided
const currentCanonical = canonicalURL || new URL(Astro.url.pathname, Astro.site).toString();

// üéØ Performance: Preload critical font files (WOFF2 for optimal compression)
// Preload ALL fonts to break critical request chain (avoid fonts loading after CSS)
const preloadResources = [
  { href: `${import.meta.env.BASE_URL}fonts/inter-400.woff2`, rel: 'preload', as: 'font', type: 'font/woff2', crossorigin: 'anonymous' },
  { href: `${import.meta.env.BASE_URL}fonts/inter-600.woff2`, rel: 'preload', as: 'font', type: 'font/woff2', crossorigin: 'anonymous' },
  { href: `${import.meta.env.BASE_URL}fonts/poppins-700.woff2`, rel: 'preload', as: 'font', type: 'font/woff2', crossorigin: 'anonymous' },
  { href: `${import.meta.env.BASE_URL}fonts/poppins-900.woff2`, rel: 'preload', as: 'font', type: 'font/woff2', crossorigin: 'anonymous' },
];
---

<!DOCTYPE html>
<html lang={lang} dir="ltr">
<head>
  <!-- Google Tag Manager with Consent Mode v2 (externalized for CSP compliance) -->
  <script src={`${import.meta.env.BASE_URL}js/gtm-init.js`}></script>
  <!-- End Google Tag Manager -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="generator" content={Astro.generator} />

  <!-- üîç SEO: Basic meta tags -->
  <title>{title}</title>
  <meta name="description" content={description} />
  <link rel="canonical" href={currentCanonical} />

  <!-- üåê SEO: Hreflang for multilingual support -->
  {alternateLanguages.map(({ lang: altLang, url }) => (
    <link rel="alternate" hreflang={altLang} href={url} />
  ))}

  <!-- üé® Favicons -->
  <link rel="icon" type="image/png" href={`${import.meta.env.BASE_URL}favicon-96x96.png`} sizes="96x96" />
  <link rel="icon" type="image/svg+xml" href={`${import.meta.env.BASE_URL}favicon.svg`} />
  <link rel="shortcut icon" href={`${import.meta.env.BASE_URL}favicon.ico`} />
  <link rel="apple-touch-icon" sizes="180x180" href={`${import.meta.env.BASE_URL}apple-touch-icon.png`} />
  <meta name="apple-mobile-web-app-title" content="Marketing AI Houston" />
  <link rel="manifest" href={`${import.meta.env.BASE_URL}site.webmanifest`} />

  <!-- üö´ SEO: Robots directive -->
  <!-- ‚ö†Ô∏è DEVELOPMENT MODE: Forced noindex during construction -->
  <!-- TODO: RE-ENABLE conditional noindex before migrating to main domain! -->
  <!-- Change back to: {noindex && <meta name="robots" content="noindex, nofollow" />} -->
  <meta name="robots" content="noindex, nofollow" />

  <!-- üì± Open Graph / Social Media -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:url" content={currentCanonical} />
  <meta property="og:image" content={ogImage} />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:alt" content={`${title} - Marketing AI Houston`} />
  <meta property="og:site_name" content="Marketing AI Houston" />

  <!-- üê¶ Twitter Cards -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={title} />
  <meta name="twitter:description" content={description} />
  <meta name="twitter:image" content={ogImage} />
  <meta name="twitter:image:alt" content={`${title} - Marketing AI Houston`} />

  <!-- üè¢ Organization Schema - Site-wide structured data -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Marketing AI Houston",
    "description": "AI-powered web design & SEO for Houston small businesses",
    "url": `${import.meta.env.SITE}${import.meta.env.BASE_URL}`,
    "logo": `${import.meta.env.SITE}${import.meta.env.BASE_URL}logo.png`,
    "email": "team@marketingaihouston.com",
    "telephone": "+1-281-544-0572",
    "contactPoint": {
      "@type": "ContactPoint",
      "email": "team@marketingaihouston.com",
      "contactType": "Customer Service",
      "areaServed": "US",
      "availableLanguage": ["English", "Spanish"]
    },
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Houston",
      "addressRegion": "TX",
      "addressCountry": "US"
    },
    "sameAs": [
      "https://www.linkedin.com/company/marketing-ai-houston",
      "https://www.facebook.com/marketingaihouston",
      "https://twitter.com/marketingaihou"
    ]
  })} />

  <!-- üìä Additional structured data from page -->
  {structuredData && (
    <script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
  )}

  <!-- ‚ö° Performance: Resource hints -->
  {preloadResources.map(resource => (
    <link {...resource} />
  ))}

  <!-- üé® Critical CSS: Self-hosted fonts for better performance -->
  <link rel="stylesheet" href={`${import.meta.env.BASE_URL}fonts/fonts.css`} />

  <!-- üõ°Ô∏è Security: CSP moved to HTTP headers in public/_headers for better security -->
  <!-- External scripts are now used instead of inline scripts for CSP compliance -->

  <style>
    /* üé® Critical CSS: Design system variables */
    :root {
      --color-ocean-deep: #0A2540;
      --color-ocean-deeper: #020617;
      --color-ocean-blue: #3B82F6;
      --color-ocean-light: #60A5FA;
      --color-ocean-teal: #198072;
      --color-ocean-teal-dark: #14B8A6;
      --color-ocean-sky: #BFDBFE;

      /* üéØ Performance: Consistent spacing scale */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;

      /* üì± Responsive typography scale */
      --text-xs: 0.75rem;
      --text-sm: 0.875rem;
      --text-base: 1rem;
      --text-lg: 1.125rem;
      --text-xl: 1.25rem;
      --text-2xl: 1.5rem;
      --text-3xl: 1.875rem;
      --text-4xl: 2.25rem;
      --text-5xl: 3rem;
    }

    /* üé® Typography system */
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', sans-serif;
      font-weight: 900;
      line-height: 1.2;
    }

    p, a, span, li, label, input, textarea {
      font-family: 'Inter', sans-serif;
    }

    /* üéØ Performance: Reduce layout shift */
    img, video, iframe {
      height: auto;
      max-width: 100%;
    }

    /* ‚ôø Accessibility: Focus indicators */
    *:focus {
      outline: 2px solid var(--color-ocean-blue);
      outline-offset: 2px;
    }

    /* üé® Custom organic shapes */
    .organic-blob {
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
    }

    .organic-droplet {
      border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%;
    }

    .organic-leaf {
      border-radius: 20% 80% 20% 80% / 80% 20% 80% 20%;
    }

    /* üé® Gradient utilities */
    .gradient-ocean {
      background: linear-gradient(135deg, var(--color-ocean-deep), var(--color-ocean-blue));
    }

    .gradient-ocean-teal {
      background: linear-gradient(135deg, var(--color-ocean-blue), var(--color-ocean-teal));
    }

    /* ‚ö° Performance: GPU-accelerated animations */
    @keyframes float {
      0%, 100% { transform: translate3d(0, 0, 0); }
      50% { transform: translate3d(0, -20px, 0); }
    }

    @keyframes blob {
      0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
      33% { transform: translate3d(30px, -50px, 0) scale(1.1); }
      66% { transform: translate3d(-20px, 20px, 0) scale(0.9); }
    }

    .animate-float {
      animation: float 6s ease-in-out infinite;
      will-change: transform;
    }

    .animate-blob {
      animation: blob 7s infinite;
      will-change: transform;
    }

    /* üéØ Performance: Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }

    /* üì± Mobile-first responsive utilities */
    @media (max-width: 640px) {
      :root {
        --text-5xl: 2.25rem;
        --text-4xl: 1.875rem;
      }
    }
  </style>

  <!-- üéØ Additional page-specific head content -->
  <slot name="head" />
</head>

<body class="font-inter text-gray-800 bg-gradient-to-br from-blue-100 to-white antialiased">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQS29VV6"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- üéØ Layout: Main content area -->
  <main id="main-content">
    <slot />
  </main>

  <!-- üç™ Cookie Consent Banner -->
  <CookieBanner currentLang={lang} />

  <!-- ‚ö° Performance & Security: External utilities script (CSP compliant) -->
  <script src={`${import.meta.env.BASE_URL}js/utilities.js`}></script>
</body>
</html>